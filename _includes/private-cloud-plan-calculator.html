{% capture plans %}{% include private-cloud-plans.json %}{% endcapture %}

<div id="myModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-body">
            <div id="closeBtn" class="close-button">
                <img src="/images/pricing/close-icon.svg" alt="Close icon">
            </div>
            <div class="card calculator">
                <h2>Private Cloud Plan calculator</h2>
                <div class="input-parameters">
                    <div class="input-group">
                        <div class="input-label-group">
                            <label for="devicesSlider" class="label">
                                Number of Devices
                                <span class="tooltip"><img src="/images/pricing/info-icon.svg" alt="Hint icon">
                                    <span class="tooltip-text">The total number of IoT devices that will connect to ThingsBoard</span>
                                </span>
                            </label>
                            <input id="devices" type="number" value="5000" class="input input-right">
                        </div>
                        <div class="slider-container">
                            <input type="range" id="devicesSlider" min="0" max="120000" step="100" value="5000" class="slider">
                            <div class="tick-marks">
                                <div class="tick-mark">
                                    <span class="tick"></span>
                                    <span class="tick-label">1</span>
                                </div>
                                <div class="tick-mark" data-num="5000">
                                    <span class="tick"></span>
                                    <span class="tick-label">5K</span>
                                </div>
                                <div class="tick-mark" data-num="25000">
                                    <span class="tick"></span>
                                    <span class="tick-label">25K</span>
                                </div>
                                <div class="tick-mark" data-num="50000">
                                    <span class="tick"></span>
                                    <span class="tick-label">50K</span>
                                </div>
                                <div class="tick-mark" data-num="100000">
                                    <span class="tick"></span>
                                    <span class="tick-label">100K</span>
                                </div>
                                <div class="tick-mark" data-num="120000">
                                    <span class="tick"></span>
                                    <span class="tick-label infinity">&#8734;</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="input-group">
                        <div class="input-label-group">
                            <label for="messages" class="label">
                                Number of Messages
                                <span class="tooltip"><img src="/images/pricing/info-icon.svg" alt="Hint icon">
                                    <span class="tooltip-text">How many messages each device sends in the selected time period</span>
                                </span>
                            </label>
                            <div class="input-with-select">
                                <input id="messages" type="number" value="1" class="input input-right">
                                <select id="messageUnit" class="select">
                                    <option value="minute">per minute</option>
                                    <option value="hour" selected>per hour</option>
                                    <option value="day">per day</option>
                                </select>
                            </div>
                        </div>
                        <div class="slider-container messages">
                            <input type="range" id="messagesSlider" min="1" max="60" step="1" value="1" class="slider">
                            <div id="msgPerHour" class="tick-marks">
                                <div class="tick-mark">
                                    <span class="tick"></span>
                                    <span class="tick-label">1</span>
                                </div>
                                <div class="tick-mark" data-num="20">
                                    <span class="tick"></span>
                                    <span class="tick-label">20</span>
                                </div>
                                <div class="tick-mark" data-num="40">
                                    <span class="tick"></span>
                                    <span class="tick-label">40</span>
                                </div>
                                <div class="tick-mark" data-num="60">
                                    <span class="tick"></span>
                                    <span class="tick-label">60</span>
                                </div>
                            </div>
                            <div id="msgPerMinute" class="tick-marks hidden">
                                <div class="tick-mark">
                                    <span class="tick"></span>
                                    <span class="tick-label">1</span>
                                </div>
                                <div class="tick-mark" data-num="20">
                                    <span class="tick"></span>
                                    <span class="tick-label">20</span>
                                </div>
                                <div class="tick-mark" data-num="40">
                                    <span class="tick"></span>
                                    <span class="tick-label">40</span>
                                </div>
                                <div class="tick-mark" data-num="60">
                                    <span class="tick"></span>
                                    <span class="tick-label">60</span>
                                </div>
                            </div>
                            <div id="msgPerDay" class="tick-marks hidden">
                                <div class="tick-mark">
                                    <span class="tick"></span>
                                    <span class="tick-label">1</span>
                                </div>
                                <div class="tick-mark" data-num="4">
                                    <span class="tick"></span>
                                    <span class="tick-label">4</span>
                                </div>
                                <div class="tick-mark" data-num="8">
                                    <span class="tick"></span>
                                    <span class="tick-label">8</span>
                                </div>
                                <div class="tick-mark" data-num="12">
                                    <span class="tick"></span>
                                    <span class="tick-label">12</span>
                                </div>
                                <div class="tick-mark" data-num="16">
                                    <span class="tick"></span>
                                    <span class="tick-label">16</span>
                                </div>
                                <div class="tick-mark" data-num="20">
                                    <span class="tick"></span>
                                    <span class="tick-label">20</span>
                                </div>
                                <div class="tick-mark" data-num="24">
                                    <span class="tick"></span>
                                    <span class="tick-label">24</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="input-group">
                        <div class="input-label-group">
                            <label for="dataPoints" class="label">
                                Data Points per Message
                                <span class="tooltip"><img src="/images/pricing/info-icon.svg" alt="Hint icon"><span
                                        class="tooltip-text">How many data points are included in each message</span></span>
                            </label>
                            <input id="dataPoints" type="number" value="10" class="input input-right">
                        </div>
                        <div class="slider-container">
                            <input type="range" id="dataPointsSlider" min="1" max="100" step="1" value="10"
                                   class="slider">
                            <div class="tick-marks">
                                <div class="tick-mark">
                                    <span class="tick"></span>
                                    <span class="tick-label">1</span>
                                </div>
                                <div class="tick-mark" data-num="20">
                                    <span class="tick"></span>
                                    <span class="tick-label">20</span>
                                </div>
                                <div class="tick-mark" data-num="40">
                                    <span class="tick"></span>
                                    <span class="tick-label">40</span>
                                </div>
                                <div class="tick-mark" data-num="60">
                                    <span class="tick"></span>
                                    <span class="tick-label">60</span>
                                </div>
                                <div class="tick-mark" data-num="80">
                                    <span class="tick"></span>
                                    <span class="tick-label">80</span>
                                </div>
                                <div class="tick-mark" data-num="100">
                                    <span class="tick"></span>
                                    <span class="tick-label">100</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="input-group">
                        <div class="input-label-group">
                            <label for="retention" class="label">
                                Data Retention (Months)
                                <span class="tooltip"><img src="/images/pricing/info-icon.svg" alt="Hint icon"><span
                                        class="tooltip-text">How long you need to store your data</span></span>
                            </label>
                            <div class="input-with-select">
                                <input id="retention" type="number" value="3" class="input input-right">
                                <select id="retentionUnit" class="select hidden">
                                    <option value="days">days</option>
                                    <option value="months" selected>months</option>
                                    <option value="years">years</option>
                                </select>
                            </div>
                        </div>
                        <div class="slider-container">
                            <input type="range" id="retentionSlider" min="1" max="60" step="1" value="3" class="slider">
                            <div class="tick-marks">
                                <div class="tick-mark">
                                    <span class="tick"></span>
                                    <span class="tick-label">1</span>
                                </div>
                                <div class="tick-mark" data-num="12">
                                    <span class="tick"></span>
                                    <span class="tick-label">12</span>
                                </div>
                                <div class="tick-mark" data-num="24">
                                    <span class="tick"></span>
                                    <span class="tick-label">24</span>
                                </div>
                                <div class="tick-mark" data-num="36">
                                    <span class="tick"></span>
                                    <span class="tick-label">36</span>
                                </div>
                                <div class="tick-mark" data-num="48">
                                    <span class="tick"></span>
                                    <span class="tick-label">48</span>
                                </div>
                                <div class="tick-mark" data-num="60">
                                    <span class="tick"></span>
                                    <span class="tick-label">60</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="input-group addons">
                        <p class="label">Add-ons</p>
                        <div class="add-ons-container">
                            <label class="add-on">
                                <input class="add-on-checkbox" id="devEnvs" type="checkbox">
                                <span class="checkmark"></span>
                                Dev Environments
                            </label>
                            <label class="add-on">
                                <input class="add-on-checkbox" id="testEnvs" type="checkbox">
                                <span class="checkmark"></span>
                                Test Environments
                            </label>
                            <label class="add-on">
                                <input class="add-on-checkbox" id="mobileApp" type="checkbox">
                                <span class="checkmark"></span>
                                White-labeled Mobile App
                            </label>
                        </div>
                    </div>
                </div>
                <button id="calculatorReset" class="btn">Reset</button>
            </div>
            <div id="resultsCard" class="card results hidden">
            </div>
        </div>
    </div>
</div>
<script>
    const privateCloudPlans = {{ plans }};

    function openModal() {
        const modal = document.getElementById('myModal');
        modal.classList.add('visible');
        document.body.style.overflow = 'hidden';
        modal.addEventListener('click', (event) => {
            if (event.target === modal) closeModal();
        });
        document.getElementById('closeBtn').addEventListener('click', () => {
            closeModal();
        });

        const devicesInput = document.getElementById('devices');
        const devicesSlider = document.getElementById('devicesSlider');
        const messagesInput = document.getElementById('messages');
        const messagesSlider = document.getElementById('messagesSlider');
        const messageUnitSelect = document.getElementById('messageUnit');
        const dataPointsInput = document.getElementById('dataPoints');
        const dataPointsSlider = document.getElementById('dataPointsSlider');
        const retentionInput = document.getElementById('retention');
        const retentionSlider = document.getElementById('retentionSlider');
        const retentionUnitSelect = document.getElementById('retentionUnit');
        const resultsCard = document.getElementById('resultsCard');
        const resetButton = document.getElementById('calculatorReset');
        const devEnvsCheckbox = document.getElementById('devEnvs');
        const testEnvsCheckbox = document.getElementById('testEnvs');
        const mobileAppCheckbox = document.getElementById('mobileApp');
        const icon = '<svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 13 13" fill="none"><path d="M5.49976 3.5H4.49976V2.5H5.49976V3.5ZM5.49976 4.5H4.49976V7.5H5.49976V4.5ZM4.99976 1C2.79426 1 0.999756 2.7945 0.999756 5C0.999756 7.2055 2.79426 9 4.99976 9C7.20526 9 8.99976 7.2055 8.99976 5C8.99976 2.7945 7.20526 1 4.99976 1ZM4.99976 0C7.76126 0 9.99976 2.2385 9.99976 5C9.99976 7.7615 7.76126 10 4.99976 10C2.23826 10 -0.000244141 7.7615 -0.000244141 5C-0.000244141 2.2385 2.23826 0 4.99976 0Z" fill="black" fill-opacity="0.76"/></svg>';

        for (let slider of [devicesSlider, messagesSlider, dataPointsSlider, retentionSlider]) {
            sliderProgress(slider);
        }
        initTickMarks();

        syncInputAndSlider(devicesInput, devicesSlider);
        syncInputAndSlider(messagesInput, messagesSlider);
        syncInputAndSlider(dataPointsInput, dataPointsSlider);
        syncInputAndSlider(retentionInput, retentionSlider);

        messageUnitSelect.addEventListener('change', function () {
            document.querySelectorAll('.slider-container.messages .tick-marks').forEach(elem => {
                elem.classList.add('hidden');
            });
            if (this.value === 'minute') {
                messagesSlider.max = 60;
                document.getElementById('msgPerMinute').classList.remove('hidden');
            }
            if (this.value === 'hour') {
                messagesSlider.max = 60;
                document.getElementById('msgPerHour').classList.remove('hidden');
            }
            if (this.value === 'day') {
                messagesSlider.max = 24;
                messagesSlider.value = 1;
                messagesInput.value = 1;
                document.getElementById('msgPerDay').classList.remove('hidden');
            }
            sliderProgress(messagesSlider);
            initTickMarks();
            calculateResults();
        });

        retentionUnitSelect.addEventListener('change', () => {
            updateRetentionSliderMax();
            calculateResults();
        });

        for (let checkbox of [devEnvsCheckbox, testEnvsCheckbox, mobileAppCheckbox]) {
            checkbox.addEventListener('input', () => {
                calculateResults()
            });
        }

        resetButton.addEventListener('click', () => {
            devicesInput.value = 1;
            devicesSlider.value = 1;
            messagesInput.value = 1;
            messagesSlider.value = 1;
            messageUnitSelect.value = 'minute';
            dataPointsInput.value = 1;
            dataPointsSlider.value = 1;
            retentionInput.value = 1;
            retentionSlider.value = 1;
            retentionUnitSelect.value = 'months';
            devEnvsCheckbox.checked = false;
            testEnvsCheckbox.checked = false;
            mobileAppCheckbox.checked = false;

            calculateResults();

            for (let slider of [devicesSlider, messagesSlider, dataPointsSlider, retentionSlider]) {
                sliderProgress(slider);
            }
        });

        calculateResults();

        function calculateResults() {
            // Get values from inputs
            const devices = Number(devicesInput.value);
            const messages = Number(messagesInput.value);
            const messageUnit = messageUnitSelect.value;
            const dataPointsPerMessage = Number(dataPointsInput.value);
            const dataRetention = Number(retentionInput.value);
            const dataRetentionUnit = retentionUnitSelect.value;
            const devEnvsValue = devEnvsCheckbox.checked;
            const testEnvsValue = testEnvsCheckbox.checked;
            const mobileAppValue = mobileAppCheckbox.checked;

            // Convert messages to per minute rate
            let messagesPerMinute = messages;
            if (messageUnit === 'day') {
                messagesPerMinute = messages / (24 * 60);
            } else if (messageUnit === 'hour') {
                messagesPerMinute = messages / 60;
            }

            // Calculate data points per minute
            const dataPointsPerMinute = devices * messagesPerMinute * dataPointsPerMessage;

            // Convert data retention to minutes
            let retentionInMinutes = dataRetention;
            if (dataRetentionUnit === 'years') {
                retentionInMinutes = dataRetention * 365 * 24 * 60;
            } else if (dataRetentionUnit === 'months') {
                retentionInMinutes = dataRetention * 30 * 24 * 60;
            } else if (dataRetentionUnit === 'days') {
                retentionInMinutes = dataRetention * 24 * 60;
            }

            // Calculate storage needed in GB
            const storageNeededInGB = (privateCloudPlans.bytesPerDataPoint * retentionInMinutes * dataPointsPerMinute) / 1073741824;

            // Find matching plans based on message rate
            const matchingPlans = privateCloudPlans.plans.filter(plan => dataPointsPerMinute <= plan.maxMsgPerMin);

            // Enterprise plan case
            if (matchingPlans.length === 0) {
                displayEnterpriseResults(dataPointsPerMinute, devices, storageNeededInGB);
                return;
            }

            // Calculate total price for each matching plan
            const planResults = matchingPlans.map(plan => {
                // Calculate extra devices
                const extraDevices = Math.max(0, devices - plan.includedDevices);
                const extraDeviceCost = extraDevices * plan.extraDevicePrice;

                // Calculate storage costs
                const adjustedStorageNeeded = storageNeededInGB * plan.replicationFactor;
                const extraStorage = Math.max(0, adjustedStorageNeeded - plan.storage);
                const extraStorageCost = extraStorage * privateCloudPlans.extraStorageCostPerGB;

                // Calculate total price
                const totalPrice = plan.price + extraDeviceCost + extraStorageCost;

                return {
                    plan,
                    extraDevices,
                    extraDeviceCost,
                    storageNeeded: adjustedStorageNeeded,
                    extraStorage,
                    extraStorageCost,
                    totalPrice,
                    dataPointsPerMinute,
                    devEnvsValue,
                    testEnvsValue,
                    mobileAppValue
                };
            });

            // Find the plan with the lowest total price
            const optimalPlan = planResults.reduce((prev, current) =>
                prev.totalPrice < current.totalPrice ? prev : current
            );

            // Display results
            displayResults(optimalPlan);
        }

        function displayResults(results) {
            const {
                plan,
                extraDevices,
                extraDeviceCost,
                storageNeeded,
                extraStorage,
                extraStorageCost,
                totalPrice,
                dataPointsPerMinute,
                devEnvsValue,
                testEnvsValue,
                mobileAppValue
            } = results;
            resultsCard.classList.remove('hidden');
            resultsCard.innerHTML = `
                <div class="card-header">
                  <h3>Calculation summary</h3>
                  <h4>
                      Optimal Plan: ${plan.name} (${formatCurrency(plan.price)})
                  </h4>
                </div>
                <div class="results">
                    <div class="results-item">
                      <span class="results-label">Data Points Rate:</span>
                      <span class="results-value">
                        ${dataPointsPerMinute.toFixed(2)} points/min
                        <span class="tooltip">${icon}<span class="tooltip-text">The rate at which your devices generate data points that need to be processed and stored.</span></span>
                      </span>
                    </div>
                    <div class="results-item">
                      <span class="results-label">Included Devices:</span>
                      <span class="results-value">
                        ${plan.includedDevices}
                      </span>
                    </div>
                    <div class="results-item">
                      <span class="results-label">Extra Devices:</span>
                      <span class="results-value">
                        ${extraDevices}
                        <span class="tooltip">${icon}<span class="tooltip-text">The number of devices exceeding what's included in your base plan.</span></span>
                      </span>
                    </div>
                    <div class="results-item">
                      <span class="results-label">Extra Device Cost:</span>
                      <span class="results-value">
                        ${formatCurrency(extraDeviceCost)}
                        <span class="tooltip">${icon}<span class="tooltip-text">The additional cost for devices beyond what's included in your base plan. <br> ${formatCurrency(extraDeviceCost)} = ${extraDevices} extra devices × $${plan.extraDevicePrice.toFixed(2)} per device</span></span>
                      </span>
                    </div>
                    <div class="results-item">
                      <span class="results-label">Included Storage:</span>
                      <span class="results-value">
                        ${plan.storage} GB
                        <span class="tooltip">${icon}<span class="tooltip-text">The amount of storage included in your base plan price. <br> The ${plan.name} plan includes ${plan.storage} GB of storage in the base price of ${formatCurrency(plan.price)}/month.</span></span>
                      </span>
                    </div>
                    <div class="results-item">
                      <span class="results-label">Storage Used:</span>
                      <span class="results-value">
                        ${storageNeeded.toFixed(2)} GB
                        <span class="tooltip">${icon}<span class="tooltip-text">The total amount of storage your data will require based on your retention period.</span></span>
                      </span>
                    </div>
                    <div class="results-item">
                      <span class="results-label">Extra Storage:</span>
                      <span class="results-value">
                        ${extraStorage.toFixed(2)} GB
                        <span class="tooltip">${icon}<span class="tooltip-text">The amount of storage exceeding what's included in your base plan. <br> ${extraStorage.toFixed(2)} GB = ${storageNeeded.toFixed(2)} GB used - ${plan.storage} GB included</span></span>
                      </span>
                    </div>
                    <div class="results-item">
                      <span class="results-label">Extra Storage Cost:</span>
                      <span class="results-value">
                        ${formatCurrency(extraStorageCost)}
                        <span class="tooltip">${icon}<span class="tooltip-text">The additional cost for storage beyond what's included in your base plan. <br> ${formatCurrency(extraStorageCost)} = ${extraStorage.toFixed(2)} GB × $${privateCloudPlans.extraStorageCostPerGB.toFixed(2)} per GB</span></span>
                      </span>
                    </div>
                </div>
                ${addonsResultsBlock()}
                <div class="results-total">
                  <span>Total monthly price:</span>
                  <span>
                    ${formatCurrency(totalPriceCalc())}
                    <span class="tooltip">${icon}<span class="tooltip-text">The total amount you'll pay each month based on your usage. <br> ${formatCurrency(totalPriceCalc())} = ${totalPriceTooltip()}</span></span>
                  </span>
                </div>
                <a id="contactUs" class="btn fill" href="/docs/contact-us/">
                    Contact Us
                    <span class="visually-hidden">to help you with your Private Cloud plan.</span>
                </a>
             `;

            function addonsResultsBlock() {
                if (devEnvsValue || testEnvsValue || mobileAppValue) {
                    let block = '<div class="addons-results"><p>Add-ons</p>'
                    if (devEnvsValue) {
                        block += `<div class="results-item">
                                      <span class="results-label">Dev Environments:</span>
                                      <span class="results-value">
                                        ${formatCurrency(privateCloudPlans.devEnvironments)}
                                  </div>`
                    }
                    if (testEnvsValue) {
                        block += `<div class="results-item">
                                      <span class="results-label">Test Environments:</span>
                                      <span class="results-value">
                                        ${formatCurrency(privateCloudPlans.testEnvironments)}
                                  </div>`
                    }
                    if (mobileAppValue) {
                        block += `<div class="results-item">
                                      <span class="results-label">White-labeled Mobile App:</span>
                                      <span class="results-value">
                                        ${formatCurrency(privateCloudPlans.mobileApp)}
                                      <span class="tooltip">${icon}<span class="tooltip-text">White-labeled Mobile App monthly price:&nbsp;${formatCurrency(privateCloudPlans.mobileApp)}. <br> ${formatCurrency(privateCloudPlans.mobileAppSetup)} one time setup fee.</span></span>
                                  </div>`
                    }
                    block += '</div>';
                    return block;
                } else {
                    return '';
                }
            }

            function totalPriceCalc() {
                let addOnsCost = 0;
                if (devEnvsValue) {
                    addOnsCost += privateCloudPlans.devEnvironments;
                }
                if (testEnvsValue) {
                    addOnsCost += privateCloudPlans.testEnvironments;
                }
                if (mobileAppValue) {
                    addOnsCost += privateCloudPlans.mobileApp;
                }
                return totalPrice + addOnsCost;
            }

            function totalPriceTooltip() {
                return `${formatCurrency(plan.price)} (base plan) + ${formatCurrency(extraDeviceCost)} (extra devices) + ${formatCurrency(extraStorageCost)} (extra storage) ${devEnvsValue ? ' + ' + formatCurrency(privateCloudPlans.devEnvironments) + ' ' + "(dev environment)" : ''}  ${testEnvsValue ? '+ ' + formatCurrency(privateCloudPlans.testEnvironments) + ' ' + "(test environment)" : ''}  ${mobileAppValue ? '+ ' + formatCurrency(privateCloudPlans.mobileApp) + ' ' + "(mobile app monthly)" : ''}`;
            }

            updateContactUsParams(results);

            function updateContactUsParams(results) {
                const {
                    plan,
                    extraDevices,
                    extraDeviceCost,
                    storageNeeded,
                    extraStorage,
                    extraStorageCost,
                    totalPrice,
                    dataPointsPerMinute,
                    devEnvsValue,
                    testEnvsValue,
                    mobileAppValue
                } = results;
                const contactButton = document.getElementById('contactUs');

                const message = `Optimal Plan: ${plan.name} (${formatCurrency(plan.price)})\n Data Points Rate: ${dataPointsPerMinute.toFixed(2)} points/min\n Included Devices: ${plan.includedDevices}\n Extra Devices: ${extraDevices}\n Extra Device Cost: ${formatCurrency(extraDeviceCost)}\n Included Storage: ${plan.storage} GB\n Storage Used: ${storageNeeded.toFixed(2)} GB\n Extra Storage: ${extraStorage.toFixed(2)} GB\n Extra Storage Cost: ${formatCurrency(extraStorageCost)}\n${addons()} \nTotal Monthly Cost: ${formatCurrency(totalPriceCalc())}`;
                contactButton.href = contactButton.href + '?subject=' + encodeURIComponent('Private Cloud') + '&message=' + encodeURIComponent(message);

                function addons() {
                    let addonsMessage = 'Add-ons:\n';
                    if (devEnvsValue || testEnvsValue || mobileAppValue) {
                        if (devEnvsValue) {
                            addonsMessage += ` Dev Environments: ${formatCurrency(privateCloudPlans.devEnvironments)}\n`;
                        }
                        if (testEnvsValue) {
                            addonsMessage += ` Test Environments: ${formatCurrency(privateCloudPlans.testEnvironments)}\n`;
                        }
                        if (mobileAppValue) {
                            addonsMessage += ` White-labeled Mobile App monthly: ${formatCurrency(privateCloudPlans.mobileApp)}, one time setup fee: ${formatCurrency(privateCloudPlans.mobileAppSetup)}\n`;
                        }
                        return addonsMessage
                    } else {
                        return ''
                    }
                }
            }
        }

        function displayEnterpriseResults(dataPointsPerMinute, devices, storageNeededInGB) {
            resultsCard.classList.remove('hidden');
            resultsCard.innerHTML = `
                <div class="card-header">
                  <h3>Calculation summary</h3>
                  <h4 class="wrap">
                      Your setup is seriously impressive. It's time for an Enterprise solution!
                  </h4>
                </div>
                <div class="results">
                 <div class="results-item">
                   <span class="results-label"> Data points rate:</span>
                   <span class="results-value">
                     ${dataPointsPerMinute.toFixed(2)} points/minute
                    <span class="tooltip">${icon}<span class="tooltip-text">The rate at which your devices generate data points that need to be processed and stored.</span></span>
                   </span>
                 </div>
                 <div class="results-item">
                   <span class="results-label">Estimated storage needed:</span>
                   <span class="results-value">
                     ${storageNeededInGB.toFixed(2)} GB
                    <span class="tooltip">${icon}<span class="tooltip-text">The amount of storage required to keep your data for the specified retention period.</span></span>
                   </span>
                 </div>
                </div>
                <div></div>
                <p class="contact-us-text">Please contact our sales team for a custom Enterprise solution.</p>
                <a id="enterpriseContactUs" class="btn fill" href="/docs/contact-us/">
                    Contact Us
                    <span class="visually-hidden">to help you with your Private Cloud plan.</span>
                </a>
                `;
            updateEnterpriseContactUsParams(dataPointsPerMinute, devices, storageNeededInGB);
        }

        function updateEnterpriseContactUsParams(dataPointsPerMinute, devices, storageNeededInGB) {
            const enterpriseContactUs = document.getElementById('enterpriseContactUs');
            const message = `Optimal Plan: Enterprise\n Data Points Rate: ${dataPointsPerMinute.toFixed(2)} points/min\n Included Devices: ${devices}\n Estimated storage needed: ${storageNeededInGB.toFixed(2)} GB`;
            enterpriseContactUs.href = enterpriseContactUs.href + '?subject=' + encodeURIComponent('Private Cloud') + '&message=' + encodeURIComponent(message);
        }

        function updateRetentionSliderMax() {
            const unit = retentionUnitSelect.value;
            if (unit === 'years') {
                retentionSlider.max = 10;
            } else if (unit === 'months') {
                retentionSlider.max = 60;
            } else if (unit === 'days') {
                retentionSlider.max = 365;
            }

            // Ensure current value doesn't exceed max
            if (Number(retentionSlider.value) > Number(retentionSlider.max)) {
                retentionSlider.value = retentionSlider.max;
                retentionInput.value = retentionSlider.max;
            }
        }

        function syncInputAndSlider(input, slider) {
            input.addEventListener('input', () => {
                slider.value = input.value;
                sliderProgress(slider);
                calculateResults();
            });

            slider.addEventListener('input', () => {
                input.value = slider.value;
                sliderProgress(slider);
                calculateResults();
            });
        }
    }

    function sliderProgress(slider) {
        const progress = (slider.value / slider.max) * 100;
        slider.style.background = `linear-gradient(to right, #2A7DEC ${progress}%, #E0E1E2 ${progress}%)`;
    }

    function formatCurrency(value) {
        return new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD',
            minimumFractionDigits: 2
        }).format(value).replace(',', ' ');
    }

    function closeModal() {
        document.getElementById('myModal').classList.remove('visible');
        document.body.style.overflow = 'auto';
    }

    function initTickMarks() {
        document.querySelectorAll('.slider-container').forEach(sliderContainer => {
            const sliderInput = sliderContainer.querySelector('input.slider');
            const min = parseInt(sliderInput.min, 10);
            const max = parseInt(sliderInput.max, 10);
            const range = max - min;
            const sliderPhysicalWidth = sliderInput.offsetWidth;
            const thumbPhysicalWidth = 25;

            let trackRatio = 0;
            if (sliderPhysicalWidth > 0) {
                trackRatio = thumbPhysicalWidth / sliderPhysicalWidth;
            }

            const tickMarks = sliderContainer.querySelectorAll('.tick-marks .tick-mark');

            tickMarks.forEach((tickMark) => {
                let tickValueText = tickMark.dataset.num;
                const tickValue = parseInt(tickValueText, 10);
                const relativeValue = (tickValue - min) / range;
                const percentPosition = ((trackRatio / 2) + (relativeValue * (1 - trackRatio))) * 100;

                tickMark.style.left = percentPosition + '%';
            });
        });
    }

</script>
